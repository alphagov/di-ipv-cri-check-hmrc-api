{
  "StateMachines": {
    "nino_check": {
      "TestCases": {
        "HappyPathTestNoPreviousAttempt": {
          "Query user attempts": "DynamoDbQueryNoResult",
          "Create new user attempt entry": "CreateUserAttemptEntrySuccess",
          "Update number of attempts by user": "UpdateUserAttemptSuccess",
          "Query user from nino": "QueryUserNINOSuccess",
          "Get User Agent": "GetUserAgentSuccess",
          "Get API URL": "GetAPIURLSuccess",
          "Get OAuth Token": "GetOAuthAccessTokenSuccess",
          "Call Matching API": "CallMatchingAPISuccess",
          "Update status to PASS": "UpdateStatusToPassSuccess",
          "Fetch Auth Code Expiry": "FetchAuthCodeExpirySuccess",
          "Fetch Session Table Name": "FetchSessionTableNameSuccess",
          "Set Auth Code for Session": "SetAuthCodeSuccess"
        },
        "HappyPathTestOn2ndAttempt": {
          "Query user attempts": "QueryUserAttemptSuccessOn2ndTry",
          "Update number of attempts by user": "UpdateUserAttemptSuccess",
          "Query user from nino": "QueryUserNINOSuccess",
          "Get User Agent": "GetUserAgentSuccess",
          "Get API URL": "GetAPIURLSuccess",
          "Get OAuth Token": "GetOAuthAccessTokenSuccess",
          "Call Matching API": "CallMatchingAPISuccess",
          "Update status to PASS": "UpdateStatusToPassSuccess",
          "Fetch Auth Code Expiry": "FetchAuthCodeExpirySuccess",
          "Fetch Session Table Name": "FetchSessionTableNameSuccess",
          "Set Auth Code for Session": "SetAuthCodeSuccess"
        },
        "InValidRequestSessionIdNotPresent": "",
        "InValidRequestNinoIdNotPresent": "",
        "MaxiumNumberOfAttemptsExceeded": {
          "Query user attempts": "QueryUserAttemptFailureAfterMoreThanTwoAttempts",
          "Update number of attempts by user": "UpdateUserAttemptSuccess",
          "Query user from nino": "QueryUserNINOSuccess",
          "Get User Agent": "GetUserAgentSuccess",
          "Get API URL": "GetAPIURLSuccess",
          "Get OAuth Token": "GetOAuthAccessTokenSuccess",
          "Call Matching API": "CallMatchingAPISuccess"
        },
        "UserNotFoundForGivenNino": {
          "Query user attempts": "DynamoDbQueryNoResult",
          "Create new user attempt entry": "CreateUserAttemptEntrySuccess",
          "Update number of attempts by user": "UpdateUserAttemptSuccess",
          "Query user from nino": "DynamoDbQueryNoResult",
          "Get User Agent": "GetUserAgentSuccess",
          "Get API URL": "GetAPIURLSuccess",
          "Get OAuth Token": "GetOAuthAccessTokenSuccess",
          "Call Matching API": "CallMatchingAPISuccess"
        }
      }
    }
  },

  "MockedResponses": {
    "UpdateStatusToPassSuccess": {
      "0": {
        "Return": {
          "SdkHttpMetadata": {
            "AllHttpHeaders": {
              "Server": ["Server"],
              "Connection": ["keep-alive"],
              "x-amzn-RequestId": [
                "8V82HGSD060LCC4P4KITG19LBFVV4KQNSO5AEMVJF66Q9ASUAAJG"
              ],
              "x-amz-crc32": ["2745614147"],
              "Content-Length": ["2"],
              "Date": ["Mon, 18 Sep 2023 12:50:38 GMT"],
              "Content-Type": ["application/x-amz-json-1.0"]
            },
            "HttpHeaders": {
              "Connection": "keep-alive",
              "Content-Length": "2",
              "Content-Type": "application/x-amz-json-1.0",
              "Date": "Mon, 18 Sep 2023 12:50:38 GMT",
              "Server": "Server",
              "x-amz-crc32": "2745614147",
              "x-amzn-RequestId": "8V82HGSD060LCC4P4KITG19LBFVV4KQNSO5AEMVJF66Q9ASUAAJG"
            },
            "HttpStatusCode": 200
          },
          "SdkResponseMetadata": {
            "RequestId": "8V82HGSD060LCC4P4KITG19LBFVV4KQNSO5AEMVJF66Q9ASUAAJG"
          }
        }
      }
    },

    "FetchAuthCodeExpirySuccess": {
      "0": {
        "Return": {
          "Payload": {
            "authCodeExpiry": 1695042038
          }
        }
      }
    },

    "FetchSessionTableNameSuccess": {
      "0": {
        "Return": {
          "Parameter": {
            "Arn": "arn:aws:ssm:eu-west-2:404250751813:parameter/common-cri-api/SessionTableName",
            "DataType": "text",
            "LastModifiedDate": "2023-08-29T14:13:17.134Z",
            "Name": "/common-cri-api/SessionTableName",
            "Type": "String",
            "Value": "session-common-cri-api",
            "Version": 1
          }
        }
      }
    },

    "SetAuthCodeSuccess": {
      "0": {
        "Return": {
          "SdkHttpMetadata": {
            "AllHttpHeaders": {
              "Server": ["Server"],
              "Connection": ["keep-alive"],
              "x-amzn-RequestId": [
                "8V82HGSD060LCC4P4KITG19LBFVV4KQNSO5AEMVJF66Q9ASUAAJG"
              ],
              "x-amz-crc32": ["2745614147"],
              "Content-Length": ["2"],
              "Date": ["Mon, 18 Sep 2023 12:50:38 GMT"],
              "Content-Type": ["application/x-amz-json-1.0"]
            },
            "HttpHeaders": {
              "Connection": "keep-alive",
              "Content-Length": "2",
              "Content-Type": "application/x-amz-json-1.0",
              "Date": "Mon, 18 Sep 2023 12:50:38 GMT",
              "Server": "Server",
              "x-amz-crc32": "2745614147",
              "x-amzn-RequestId": "8V82HGSD060LCC4P4KITG19LBFVV4KQNSO5AEMVJF66Q9ASUAAJG"
            },
            "HttpStatusCode": 200
          },
          "SdkResponseMetadata": {
            "RequestId": "8V82HGSD060LCC4P4KITG19LBFVV4KQNSO5AEMVJF66Q9ASUAAJG"
          }
        }
      }
    },

    "DynamoDbQueryNoResult": {
      "0": {
        "Return": {
          "Count": 0,
          "Items": [],
          "ScannedCount": 0
        }
      }
    },
    "QueryUserNotFoundGivenNINO": {
      "0": {
        "Return": {
          "Count": 0,
          "Items": [],
          "ScannedCount": 0
        }
      }
    },
    "QueryUserAttemptSuccessOn2ndTry": {
      "0": {
        "Return": {
          "Count": 1,
          "Items": [
            {
              "id": {
                "S": "12345"
              },
              "attempts": {
                "N": "1"
              }
            }
          ],
          "ScannedCount": 1
        }
      }
    },
    "QueryUserAttemptFailureAfterMoreThanTwoAttempts": {
      "0": {
        "Return": {
          "Count": 1,
          "Items": [
            {
              "id": {
                "S": "12345"
              },
              "attempts": {
                "N": "2"
              }
            }
          ],
          "ScannedCount": 1
        }
      }
    },
    "CreateUserAttemptEntrySuccess": {
      "0": {
        "Return": {
          "Count": 0,
          "Items": [],
          "ScannedCount": 0
        }
      }
    },
    "UpdateUserAttemptSuccess": {
      "0": {
        "Return": {
          "Count": 0,
          "Items": [],
          "ScannedCount": 0
        }
      }
    },
    "QueryUserNINOSuccess": {
      "0": {
        "Return": {
          "Count": 1,
          "Items": [
            {
              "firstName": {
                "S": "Jim"
              },
              "lastName": {
                "S": "Ferguson"
              },
              "dob": {
                "S": "1948-04-23"
              },
              "nino": {
                "S": "AA000003C"
              }
            }
          ],
          "ScannedCount": 1
        }
      }
    },
    "GetUserAgentSuccess": {
      "0": {
        "Return": {
          "Parameter": {
            "Value": "govuk-one-login"
          }
        }
      }
    },
    "GetAPIURLSuccess": {
      "0": {
        "Return": {
          "Parameter": {
            "Value": "https://test-api.service.hmrc.gov.uk/individuals/authentication/authenticator/match"
          }
        }
      }
    },
    "GetOAuthAccessTokenSuccess": {
      "0": {
        "Return": {
          "SecretString": "c6b5e15b1c8aa61213f7f58d3e291399"
        }
      }
    },
    "CallMatchingAPISuccess": {
      "0": {
        "Return": {
          "Payload": {
            "firstName": "Jim",
            "lastName": "Ferguson",
            "dateOfBirth": "1948-04-23",
            "nino": "AA000003D"
          }
        }
      }
    }
  }
}
