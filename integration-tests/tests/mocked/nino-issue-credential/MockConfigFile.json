{
  "StateMachines": {
    "nino_issue_credential": {
      "TestCases": {
        "HappyPath": {
          "Fetch SSM Parameters": "FetchSSMParamsSuccess",
          "Query Session Item": "QuerySessionItem",
          "Fetch details from person identity": "FetchDetailsFromPersonIdentity",
          "Fetch Nino": "FetchNino",
          "Create Credential Subject": "CreateCredentialSubject",
          "Fetch exp time and NBF": "FetchExpTimeAndNBF",
          "Fetch Failed Attempts": "FetchFailedAttempts",
          "Sign VC claimsSet": "SignVCClaimSet",
          "Publish Audit Event VC Issued": "PublishAuditEventVcIssued"
        },
        "UnHappyPath": {
          "Fetch SSM Parameters": "FetchSSMParamsSuccess",
          "Query Session Item": "QuerySessionItem",
          "Fetch details from person identity": "FetchDetailsFromPersonIdentity",
          "Fetch Nino": "FetchNino",
          "Create Credential Subject": "CreateCredentialSubject",
          "Fetch exp time and NBF": "FetchExpTimeAndNBF",
          "Fetch Failed Attempts": "FetchExceededFailedAttempts",
          "Fetch CI": "FetchCI",
          "Sign VC claimsSet": "SignVCClaimSet",
          "Publish Audit Event VC Issued": "PublishAuditEventVcIssued"
        }
      }
    }
  },
  "MockedResponses": {
    "PublishAuditEventVcIssued": {
      "0": {
        "Return": null
      }
    },
    "FetchSSMParamsSuccess": {
      "0": {
        "Return": {
          "Payload": [
            {
              "Name": "/common-cri-api/SessionTableName",
              "Value": "dummy-value"
            },
            {
              "Name": "/check-hmrc-cri-api-suraj-cache/MaxJwtTtl",
              "Value": "dummy-value"
            },
            {
              "Name": "/check-hmrc-cri-api-suraj-cache/JwtTtlUnit",
              "Value": "dummy-value"
            },
            {
              "Name": "/common-cri-api/verifiableCredentialKmsSigningKeyId",
              "Value": "dummy-value"
            },
            {
              "Name": "/common-cri-api/PersonIdentityTableName",
              "Value": "dummy-value"
            },
            {
              "Name": "/check-hmrc-cri-api/contraindicationMappings",
              "Value": "dummy-value"
            },
            {
              "Name": "/common-cri-api/verifiable-credential/issuer",
              "Value": "dummy-value"
            }
          ]
        }
      }
    },
    "QuerySessionItem": {
      "0": {
        "Return": {
          "Count": 1,
          "Items": [
            {
              "subject": {
                "S": "test"
              },
              "sessionId": {
                "S": "123456789"
              },
              "accessToken": {
                "S": "Bearer test"
              }
            }
          ],
          "ScannedCount": 1
        }
      }
    },
    "FetchDetailsFromPersonIdentity": {
      "0": {
        "Return": {
          "Count": 1,
          "Items": [
            {
              "names": {
                "L": [
                  {
                    "M": {
                      "nameParts": {
                        "L": [
                          {
                            "M": {
                              "type": {
                                "S": "GivenName"
                              },
                              "value": {
                                "S": "Jim"
                              }
                            }
                          },
                          {
                            "M": {
                              "type": {
                                "S": "FamilyName"
                              },
                              "value": {
                                "S": "Ferguson"
                              }
                            }
                          }
                        ]
                      }
                    }
                  }
                ]
              },
              "sessionId": {
                "S": "123456789"
              },
              "birthDates": {
                "L": [
                  {
                    "M": {
                      "value": {
                        "S": "1948-04-23"
                      }
                    }
                  }
                ]
              },
              "nino": {
                "S": "AA000003D"
              }
            }
          ],
          "ScannedCount": 1
        }
      }
    },
    "FetchNino": {
      "0": {
        "Return": {
          "Item": {
            "sessionId": {
              "S": "123456789"
            },
            "nino": {
              "S": "AA000003D"
            }
          },
          "SdkHttpMetadata": {
            "AllHttpHeaders": {
              "Server": ["Server"],
              "Connection": ["keep-alive"],
              "x-amzn-RequestId": [
                "UBN5LMPIPOSG6VVSNBII02TEJFVV4KQNSO5AEMVJF66Q9ASUAAJG"
              ],
              "x-amz-crc32": ["3691538148"],
              "Content-Length": ["65"],
              "Date": ["Tue, 14 Nov 2023 12:29:15 GMT"],
              "Content-Type": ["application/x-amz-json-1.0"]
            },
            "HttpHeaders": {
              "Connection": "keep-alive",
              "Content-Length": "65",
              "Content-Type": "application/x-amz-json-1.0",
              "Date": "Tue, 14 Nov 2023 12:29:15 GMT",
              "Server": "Server",
              "x-amz-crc32": "3691538148",
              "x-amzn-RequestId": "UBN5LMPIPOSG6VVSNBII02TEJFVV4KQNSO5AEMVJF66Q9ASUAAJG"
            },
            "HttpStatusCode": 200
          },
          "SdkResponseMetadata": {
            "RequestId": "UBN5LMPIPOSG6VVSNBII02TEJFVV4KQNSO5AEMVJF66Q9ASUAAJG"
          }
        }
      }
    },
    "CreateCredentialSubject": {
      "0": {
        "Return": {
          "ExecutedVersion": "$LATEST",
          "Payload": {
            "socialSecurityRecord": [
              {
                "personalNumber": "AA000003D"
              }
            ],
            "name": [
              {
                "nameParts": [
                  {
                    "type": "GivenName",
                    "value": "Jim"
                  },
                  {
                    "type": "FamilyName",
                    "value": "Ferguson"
                  }
                ]
              }
            ]
          },
          "SdkHttpMetadata": {
            "AllHttpHeaders": {
              "X-Amz-Executed-Version": ["$LATEST"],
              "x-amzn-Remapped-Content-Length": ["0"],
              "Connection": ["keep-alive"],
              "x-amzn-RequestId": ["1ea2ffe5-3bf3-4907-88ea-8d2aeb974ed9"],
              "Content-Length": ["158"],
              "Date": ["Tue, 14 Nov 2023 12:29:16 GMT"],
              "X-Amzn-Trace-Id": [
                "root=1-6553681b-2b7cbbce403466dc6c23dc13;sampled=0;lineage=acbd3b6c:0"
              ],
              "Content-Type": ["application/json"]
            },
            "HttpHeaders": {
              "Connection": "keep-alive",
              "Content-Length": "158",
              "Content-Type": "application/json",
              "Date": "Tue, 14 Nov 2023 12:29:16 GMT",
              "X-Amz-Executed-Version": "$LATEST",
              "x-amzn-Remapped-Content-Length": "0",
              "x-amzn-RequestId": "1ea2ffe5-3bf3-4907-88ea-8d2aeb974ed9",
              "X-Amzn-Trace-Id": "root=1-6553681b-2b7cbbce403466dc6c23dc13;sampled=0;lineage=acbd3b6c:0"
            },
            "HttpStatusCode": 200
          },
          "SdkResponseMetadata": {
            "RequestId": "1ea2ffe5-3bf3-4907-88ea-8d2aeb974ed9"
          },
          "StatusCode": 200
        }
      }
    },
    "FetchExpTimeAndNBF": {
      "0": {
        "Return": {
          "ExecutedVersion": "$LATEST",
          "Payload": {
            "nbf": 1699964956131,
            "expiry": 1699972156131
          },
          "SdkHttpMetadata": {
            "AllHttpHeaders": {
              "X-Amz-Executed-Version": ["$LATEST"],
              "x-amzn-Remapped-Content-Length": ["0"],
              "Connection": ["keep-alive"],
              "x-amzn-RequestId": ["9c68a67e-6091-48a7-ac92-53af1da8677b"],
              "Content-Length": ["44"],
              "Date": ["Tue, 14 Nov 2023 12:29:16 GMT"],
              "X-Amzn-Trace-Id": [
                "root=1-6553681b-1f7e69db5b5a8ccd6c13a903;sampled=0;lineage=9be44ed0:0"
              ],
              "Content-Type": ["application/json"]
            },
            "HttpHeaders": {
              "Connection": "keep-alive",
              "Content-Length": "44",
              "Content-Type": "application/json",
              "Date": "Tue, 14 Nov 2023 12:29:16 GMT",
              "X-Amz-Executed-Version": "$LATEST",
              "x-amzn-Remapped-Content-Length": "0",
              "x-amzn-RequestId": "9c68a67e-6091-48a7-ac92-53af1da8677b",
              "X-Amzn-Trace-Id": "root=1-6553681b-1f7e69db5b5a8ccd6c13a903;sampled=0;lineage=9be44ed0:0"
            },
            "HttpStatusCode": 200
          },
          "SdkResponseMetadata": {
            "RequestId": "9c68a67e-6091-48a7-ac92-53af1da8677b"
          },
          "StatusCode": 200
        }
      }
    },
    "FetchFailedAttempts": {
      "0": {
        "Return": {
          "Count": 1,
          "Items": [
            {
              "id": {
                "S": "123456789"
              },
              "outcome": {
                "S": "PASS"
              },
              "attempts": {
                "N": "1"
              }
            }
          ],
          "ScannedCount": 1
        }
      }
    },
    "FetchExceededFailedAttempts": {
      "0": {
        "Return": {
          "Count": 2,
          "Items": [
            {
              "text": {
                "S": "DOB does not match CID"
              },
              "sessionId": {
                "S": "issue-credential-unhappy"
              },
              "attempt": {
                "S": "FAIL"
              },
              "timestamp": {
                "S": "1704723616968"
              }
            },
            {
              "text": {
                "S": "DOB does not match CID"
              },
              "sessionId": {
                "S": "issue-credential-unhappy"
              },
              "attempt": {
                "S": "FAIL"
              },
              "timestamp": {
                "S": "1704723616969"
              }
            }
          ],
          "ScannedCount": 2
        }
      }
    },
    "FetchCI": {
      "0": {
        "Return": {
          "ExecutedVersion": "$LATEST",
          "Payload": ["AAA"],
          "SdkHttpMetadata": {
            "AllHttpHeaders": {
              "X-Amz-Executed-Version": ["$LATEST"],
              "x-amzn-Remapped-Content-Length": ["0"],
              "Connection": ["keep-alive"],
              "x-amzn-RequestId": ["8d137f0e-31be-4d30-a09e-85da3197dbb9"],
              "Content-Length": ["7"],
              "Date": ["Mon, 08 Jan 2024 14:20:19 GMT"],
              "X-Amzn-Trace-Id": [
                "root=1-659c04a2-6e34b4cf4e19d19b75684a75;sampled=0;lineage=499fa3f8:0"
              ],
              "Content-Type": ["application/json"]
            },
            "HttpHeaders": {
              "Connection": "keep-alive",
              "Content-Length": "7",
              "Content-Type": "application/json",
              "Date": "Mon, 08 Jan 2024 14:20:19 GMT",
              "X-Amz-Executed-Version": "$LATEST",
              "x-amzn-Remapped-Content-Length": "0",
              "x-amzn-RequestId": "8d137f0e-31be-4d30-a09e-85da3197dbb9",
              "X-Amzn-Trace-Id": "root=1-659c04a2-6e34b4cf4e19d19b75684a75;sampled=0;lineage=499fa3f8:0"
            },
            "HttpStatusCode": 200
          },
          "SdkResponseMetadata": {
            "RequestId": "8d137f0e-31be-4d30-a09e-85da3197dbb9"
          },
          "StatusCode": 200
        }
      }
    },
    "SignVCClaimSet": {
      "0": {
        "Return": {
          "ExecutedVersion": "$LATEST",
          "Payload": "eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiIsImtpZCI6IjA5NzZjMTFlLThlZjMtNDY1OS1iN2YyLWVlMGI4NDJiODViZCJ9.eyJ2YyI6eyJldmlkZW5jZSI6W3sidHlwZSI6IklkZW50aXR5Q2hlY2siLCJzdHJlbmd0aFNjb3JlIjoyLCJ2YWxpZGl0eVNjb3JlIjowLCJmYWlsZWRDaGVja0RldGFpbHMiOlt7ImNoZWNrTWV0aG9kIjoiZGF0YSJ9XSwiY2kiOlsiTjAxIl0sInR4biI6ImQzYmFlNzI5LTEyN2UtNGExYS1iZTViLTBkY2VjNjhmOWRjOSJ9XSwiY3JlZGVudGlhbFN1YmplY3QiOnsic29jaWFsU2VjdXJpdHlSZWNvcmQiOlt7InBlcnNvbmFsTnVtYmVyIjoiQUEwMDAwMDNEIn1dLCJuYW1lIjpbeyJuYW1lUGFydHMiOlt7InR5cGUiOiJHaXZlbk5hbWUiLCJ2YWx1ZSI6IkppbSJ9LHsidHlwZSI6IkZhbWlseU5hbWUiLCJ2YWx1ZSI6IkZlcmd1c29uIn1dfV19LCJ0eXBlIjpbIlZlcmlmaWFibGVDcmVkZW50aWFsIiwiSWRlbnRpdHlDaGVja0NyZWRlbnRpYWwiXSwiQGNvbnRleHQiOlsiaHR0cHM6Ly93d3cudzMub3JnLzIwMTgvY3JlZGVudGlhbHMvdjEiLCJodHRwczovL3ZvY2FiLmxvbmRvbi5jbG91ZGFwcHMuZGlnaXRhbC9jb250ZXh0cy9pZGVudGl0eS12MS5qc29ubGQiXX0sInN1YiI6InRlc3QiLCJuYmYiOjE3MDk1NjA2MTgsImlzcyI6IjA5NzZjMTFlLThlZjMtNDY1OS1iN2YyLWVlMGI4NDJiODViZCIsImV4cCI6MTcwOTU2NzgxOCwianRpIjoidXJuOnV1aWQ6MjdkZDYxYzQtYjkxZS00Y2I4LTljMTQtNjVlMjJkMTY0YjFlIn0.ZzZLYTBqS1pmelpHZm1lY1BpY2R2VTc3N2NCWXNSUGM4TTRsemxPZ3FpSm9odTYweG9DckZaNHZjc0JiejVPNUU3X2RvdTFOSXA5a2U0NVFOaDd1SkE",
          "SdkHttpMetadata": {
            "AllHttpHeaders": {
              "X-Amz-Executed-Version": ["$LATEST"],
              "x-amzn-Remapped-Content-Length": ["0"],
              "Connection": ["keep-alive"],
              "x-amzn-RequestId": ["20229acd-1926-4994-be1f-752b8767e4bb"],
              "Content-Length": ["88"],
              "Date": ["Thu, 23 Nov 2023 15:55:38 GMT"],
              "X-Amzn-Trace-Id": [
                "root=1-655f75f9-27f6647873d4d7973877b13e;sampled=0;lineage=43496acb:0"
              ],
              "Content-Type": ["application/json"]
            },
            "HttpHeaders": {
              "Connection": "keep-alive",
              "Content-Length": "88",
              "Content-Type": "application/json",
              "Date": "Thu, 23 Nov 2023 15:55:38 GMT",
              "X-Amz-Executed-Version": "$LATEST",
              "x-amzn-Remapped-Content-Length": "0",
              "x-amzn-RequestId": "20229acd-1926-4994-be1f-752b8767e4bb",
              "X-Amzn-Trace-Id": "root=1-655f75f9-27f6647873d4d7973877b13e;sampled=0;lineage=43496acb:0"
            },
            "HttpStatusCode": 200
          },
          "SdkResponseMetadata": {
            "RequestId": "20229acd-1926-4994-be1f-752b8767e4bb"
          },
          "StatusCode": 200
        }
      }
    }
  }
}
